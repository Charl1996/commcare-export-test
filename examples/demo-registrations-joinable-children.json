{
    "List": [
        { "Emit": {
            "table": "Registrations",
            "headings": [
                {"Lit": "id"},
                {"Lit": "Received On"},
                {"Lit": "Mother's Name"},
                {"Lit": "Age"},
                {"Lit": "Pregnant?"},
                {"Lit": "Estimated Delivery Date"}
            ],
            "source": {"Map": {
                "body": {
                    "List": [
                        {"Ref": "id"},
                        {"Ref": "received_on"},
                        {"Ref": "form.name"},
                        {"Ref": "form.age"},
                        {"Ref": "form.ispregnant"},
                        {"Ref": "form.edd"}
                    ]
                },
                "source": {"Apply": {
                    "fn": {"Ref": "api_data"}, 
                    "args": [
                        {"Lit": "form"}, 
                        {"Lit": {"filter": {"and":[
                            {"term": {"app_id": "YOUR_APP_ID"}},
                            {"term": {"xmlns.exact": "http://openrosa.org/formdesigner/dd3190c7dd7e9e7d469a9705709f2f6b4e27f1d8"}}
                        ]}}}
                    ]
                }}
            }}
        }},
        { "Emit": {
            "table": "Child Facts",
            "headings": [
                {"Lit": "ID"},
                {"Lit": "Form ID"},
                {"Lit": "Gender"},
                {"Lit": "Birth Weight"}
            ],
            "source": {"FlatMap": {
                "source": {"Apply": {
                    "fn": {"Ref": "api_data"}, 
                    "args": [
                        {"Lit": "form"}, 
                        {"Lit": {"filter": {"and":[
                            {"term": {"app_id": "YOUR_APP_ID"}},
                            {"term": {"xmlns.exact": "http://openrosa.org/formdesigner/74CCF2B2-AB85-4F1D-9CD7-5203056BB213"}}
                        ]}}}
                    ]
                }},
                "body": { "Bind": {
                    "name":  "form_id",
                    "value": {"Ref":"id"},
                    "body": {"Map":{
                        "source":{"Ref": "form.delivery_information.child_questions[*]"},
                        "name":"child_questions",
                        "body":{
                            "List": [
                                {"Ref": "child_questions.id"},
                                {"Ref": "form_id"},
                                {"Ref": "child_questions.gender"},
                                {"Ref": "child_questions.birth_weight"}
                            ]
                        }
                    }}
                }}
            }}
        }}
    ]
}
